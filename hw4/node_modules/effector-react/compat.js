'use strict';function e(e){return e&&'object'==typeof e&&'default'in e?e.default:e}function t(e,t,n,r){var o=[d.step.mov({store:e.stateRef,to:'stack'}),d.step.run({fn:function(e){return t(e)}})];if(r&&o.unshift(r),n){var u=d.createNode({node:o,meta:{watchOp:"store"}}),a=e.graphite.id,c=n.additionalLinks,s=c[a]||[];return c[a]=s,s.push(u),function(){var e=s.indexOf(u);-1!==e&&s.splice(e,1),d.clearNode(u)}}var i=d.createNode({node:o,parent:[e],family:{owners:e}});return function(){d.clearNode(i)}}function n(e,t){return t.displayName=e,t}function r(e,n){d.is.store(e)||b('expect useStore argument to be a store');var r=h.useCallback((function(r){return t(e,r,n)}),[e,n]),o=h.useCallback((function(){return x(e,n)}),[e,n]);return y.useSyncExternalStore(r,o,o)}function o(e,n){var r=d.is.unit(e),o={};r?o={unit:e}:'@@unitShape'in e?'function'==typeof e['@@unitShape']?o=e['@@unitShape']():b('expect @@unitShape to be a function'):o=e;var u=Array.isArray(o),a=h.useRef({stale:1,justSubscribed:0,scope:n}),c=h.useMemo((function(){a.current.stale=1;var e=Array.isArray(o)?[]:{},t=[],r=[],u=[],c=[];for(var s in o){var i=o[s];d.is.unit(i)||b('expect useUnit argument to be a unit'),d.is.event(i)||d.is.effect(i)?(e[s]=n?d.scopeBind(i,{scope:n}):i,u.push(s),c.push(i)):(e[s]=null,t.push(s),r.push(i))}return[e,t,r,u,c]}),[a,n].concat(Object.keys(o),Object.values(o))),s=c[0],i=c[1],f=c[2],l=c[3],v=c[4],p=h.useRef({value:s,storeKeys:i,eventKeys:l,eventValues:v}),m=h.useCallback((function(e){var r=a.current;r.justSubscribed=1;var o=function(){r.stale||(r.stale=1,e())},u=d.step.compute({priority:'sampler',batch:1}),c=f.map((function(e){return t(e,o,n,u)}));return function(){c.forEach((function(e){return e()}))}}),[f,n,p,a]),S=h.useCallback((function(){var e,t=p.current,o=a.current,c=0,d=t.value,y=t.storeKeys,m=t.eventKeys,h=t.eventValues,b=n!==o.scope;if(o.stale||o.justSubscribed||b){c=!o.justSubscribed||b,e=u?[].concat(s):Object.assign({},s),y.length===i.length&&m.length===l.length||(c=1);for(var S=0;S<i.length;S++){var g=x(f[S],n),k=i[S];c||(c=y.includes(k)?d[k]!==g:1),e[k]=g}for(var j=0;j<l.length;j++){var C=v[j],E=l[j];c||(c=m.includes(E)?h[m.indexOf(E)]!==C:1)}}return c&&(t.value=e),t.storeKeys=i,t.eventKeys=l,t.eventValues=v,o.stale=0,o.justSubscribed=!c,o.scope=n,r?t.value.unit:t.value}),[m,f,v,n,p,a]);return y.useSyncExternalStore(m,S,S)}function u(e,n){var r,o,u,a,c=e[0],s=e[1],i=g;if(s)r=s,u=c,a=[];else{r=c.fn,u=c.store,a=c.keys,o=c.defaultValue;var f=c.updateFilter;i=void 0===f?g:f}d.is.store(u)||b('useStoreMap expects a store'),Array.isArray(a)||b('useStoreMap expects an array as keys'),'function'!=typeof r&&b('useStoreMap expects a function');var l=h.useCallback((function(e){return t(u,e,n)}),[u,n]),v=h.useCallback((function(){return x(u,n)}),[u,n]),p=h.useRef(),y=h.useRef(),S=h.useRef(a);return m.useSyncExternalStoreWithSelector(l,v,v,(function(e){if(p.current!==e||!function(e,t){if(!e||!t||e.length!==t.length)return 0;for(var n=1,r=0;r<e.length;r++)if(e[r]!==t[r]){n=0;break}return n}(S.current,a)){var t=r(e,a);void 0===t&&void 0!==o&&(t=o),p.current=e,S.current=a,void 0!==t&&(y.current=t)}return y.current}),(function(e,t){return!i(t,e)}))}function a(e,t,n){void 0===t&&(t={});var r=o({open:e.open,close:e.close,set:e.set},n),u=r.open,a=r.close,c=r.set,s=h.useMemo((function(){return{open:u,close:a,set:c}}),[e,u]),i=h.useRef({value:null,count:0});S((function(){return s.open(i.current.value),function(){return s.close(i.current.value)}}),[s]),function(e,t){if(e===t)return 1;if('object'==typeof e&&null!==e&&'object'==typeof t&&null!==t){var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return 0;for(var o=0;o<n.length;o++){var u=n[o];if(e[u]!==t[u])return 0}return 1}return 0}(i.current.value,t)||(i.current.value=t,i.current.count+=1),S((function(){s.set(i.current.value)}),[i.current.count])}function c(e){var t=h.useContext(k);return e&&!t&&b('No scope found, consider adding <Provider> to app root'),t}function s(e,t){return r(e,c(null==t?void 0:t.forceScope))}function i(e,t){function r(e){var n=h.useRef(e),r=s(o);S((function(){return a({props:n.current,state:o.getState()}),function(){c({props:n.current,state:o.getState()})}}),[]);var u=t(e,r);return n.current=e,u}var o;d.is.store(e)?o=e:'object'==typeof e&&null!==e?o=d.combine(e):b('shape should be a store or object with stores');var u='Unknown';o&&o.shortName&&(u=o.shortName);var a=d.createEvent(),c=d.createEvent();return r.mounted=a,r.unmounted=c,n(u+".View",r)}function f(e,t){var n,r=t?e:e[0];(function(e){if(!e)throw Error('expect first argument be an object')})(E(n=r)||function(e){return'function'==typeof e}(n));var o=r.or,u=r.and;if(u){var a=t?u:u[0];if(E(a)&&'and'in a){var c=f(u,t);e=c[0],o=Object.assign({},o,c[1])}else e=u}return[e,o]}function l(e){function t(e){return u(t,e,c()),null}var r=e.domain,o=e.defaultState,u=e.hook,a=w({or:e.maybeConfig,and:e.mainConfig}),s=(r?r.compositeName.fullName+"/":'')+(a.name||'gate'),i=d.createEvent({name:s+".set",sid:a.sid?a.sid+"|set":void 0}),f=d.createEvent({name:s+".open",sid:a.sid?a.sid+"|open":void 0}),l=d.createEvent({name:s+".close",sid:a.sid?a.sid+"|close":void 0}),v=d.createStore(Boolean(0),{name:s+".status",serialize:'ignore'}).on(f,(function(){return Boolean(1)})).on(l,(function(){return Boolean(0)})),p=d.createStore(o,{name:s+".state",sid:a.sid}).on(i,(function(e,t){return t})).on(f,(function(e,t){return t})).reset(l);if(r){var y=r.hooks;d.launch({target:[y.store,y.store,y.event,y.event,y.event],params:[v,p,f,l,i]})}return t.open=f,t.close=l,t.status=v,t.state=p,t.set=i,n("Gate:"+s,t)}function v(e,t){var n,r,o,u=f(t&&E(n=t[0])&&(n.and||n.or)?t:[{and:t}]),a=u[0],c=a[0],s=a[1],i={},l={},v=u[1];return'string'==typeof c?(l={name:c},E(o=s)&&'sid'in o||(i=s||{})):function(e){return E(e)&&('domain'in e||'defaultState'in e||'name'in e)}(c)&&(l=c,i=c.defaultState||{},r=c.domain),{hook:e,domain:r,defaultState:i,mainConfig:l,maybeConfig:v}}Object.defineProperty(exports,'__esModule',{value:1});var p=require('react'),d=require('effector/compat'),y=require('use-sync-external-store/shim/index.js'),m=require('use-sync-external-store/shim/with-selector.js'),h=e(p),b=function(e){throw Error(e)},S='undefined'!=typeof window?h.useLayoutEffect:h.useEffect,x=function(e,t){return t?t.getState(e):e.getState()},g=function(e,t){return e!==t},k=h.createContext(null),j=function(e){return console.error(e+" is deprecated")},C=function(e){return function(t){var r=e;return'function'!=typeof e&&(r=t,t=e),n("Connect("+(r.displayName||r.name||'Unknown')+")",(function(e){return h.createElement(r,Object.assign({},e,s(t)))}))}},E=function(e){return'object'==typeof e&&null!==e},w=function e(t,n){return void 0===n&&(n={}),E(t)&&(e(t.or,n),function(e){for(var t in e)o=t,function(e){return void 0===e}(r=e[t])||'or'===o||'and'===o||(n[o]=r);var r,o}(t),e(t.and,n)),n};exports.Provider=k.Provider,exports.connect=C,exports.createComponent=i,exports.createContextComponent=function(e,t,r){return j('createContextComponent'),n((e.shortName||'Unknown')+".ContextComponent",(function(n){var o=h.useContext(t),u=s(e);return r(n,u,o)}))},exports.createGate=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return l(v(a,t))},exports.createReactState=function(e,t){return j('createReactState'),C(t)(e)},exports.createStoreConsumer=function(e){return i(e,(function(e,t){return(0,e.children)(t)}))},exports.useEvent=function(e,t){return function(e,t){if(!t)return e;var n=d.is.unit(e)||'object'!=typeof e?{event:e}:e;return h.useMemo((function(){if(d.is.unit(e))return d.scopeBind(e,{scope:t});var n=Array.isArray(e)?[]:{};for(var r in e)n[r]=d.scopeBind(e[r],{scope:t});return n}),[t].concat(Object.keys(n),Object.values(n)))}(e,c(null==t?void 0:t.forceScope))},exports.useGate=function(e,t,n){return void 0===t&&(t={}),a(e,t,c(null==n?void 0:n.forceScope))},exports.useList=function(e,t,o){return function(e,t,o){var a,c,s,i=[];'object'==typeof t&&null!==t?(t.keys&&(i=t.keys),a=t.fn,c=t.getKey,s=t.placeholder):a=t,d.is.store(e)||b('expect useList first argument to be a store'),'function'!=typeof a&&b("expect useList's renderItem to be a function"),Array.isArray(i)||b("expect useList's keys to be an array");var f=h.useMemo((function(){var t=n((e.shortName||'Unknown')+".Item",(function(t){var n=t.index,r=t.keys;if(l.current[1])return l.current[0](t.value,t.keyVal);var a=u([{store:e,keys:[n].concat(r),fn:function(e,t){return e[t[0]]}}],o);return l.current[0](a,n)}));return h.memo(t)}),[e,o,!!c]),l=h.useRef([a,c]);l.current=[a,c];var v=h.useMemo((function(){return i}),i);if(c){var p=r(e,o);return 0===p.length&&s?s:p.map((function(e){var t=l.current[1](e);return h.createElement(f,{keyVal:t,key:t,keys:v,value:e})}))}var y=u([{store:e,keys:[e],fn:function(e){return e.length}}],o);return 0===y&&s?s:Array.from({length:y},(function(e,t){return h.createElement(f,{index:t,key:t,keys:v})}))}(e,t,c(null==o?void 0:o.forceScope))},exports.useStore=s,exports.useStoreMap=function(e,t){return u([e,t],c(null==e?void 0:e.forceScope))},exports.useUnit=function(e,t){return o(e,c(null==t?void 0:t.forceScope))};
//# sourceMappingURL=compat.js.map
