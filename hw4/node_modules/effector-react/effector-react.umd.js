((e,t)=>{'object'==typeof exports&&'undefined'!=typeof module?t(exports,require('react'),require('effector'),require('use-sync-external-store/shim/index.js'),require('use-sync-external-store/shim/with-selector.js')):'function'==typeof define&&define.amd?define(['exports','react','effector','use-sync-external-store/shim/index.js','use-sync-external-store/shim/with-selector.js'],t):t((e='undefined'!=typeof globalThis?globalThis:e||self).effectorReact={},e.React,e.effector,e.useSyncExternalStoreShim,e.useSyncExternalStoreWithSelectorShim)})(this,((e,t,effector,n,r)=>{function o(e){return e&&'object'==typeof e&&'default'in e?e:{default:e}}function u(e,t,n,r){let o=[effector.step.mov({store:e.stateRef,to:'stack'}),effector.step.run({fn:e=>t(e)})];if(r&&o.unshift(r),n){let t=effector.createNode({node:o,meta:{watchOp:"store"}}),r=e.graphite.id,u=n.additionalLinks,s=u[r]||[];return u[r]=s,s.push(t),()=>{let e=s.indexOf(t);-1!==e&&s.splice(e,1),effector.clearNode(t)}}{let t=effector.createNode({node:o,parent:[e],family:{owners:e}});return()=>{effector.clearNode(t)}}}function s(e,t){return t.displayName=e,t}function a(e,t){effector.is.store(e)||v('expect useStore argument to be a store');let r=h.default.useCallback((n=>u(e,n,t)),[e,t]),o=h.default.useCallback((()=>S(e,t)),[e,t]);return n.useSyncExternalStore(r,o,o)}function l(e,t){let r=effector.is.unit(e),o={};r?o={unit:e}:'@@unitShape'in e?'function'==typeof e['@@unitShape']?o=e['@@unitShape']():v('expect @@unitShape to be a function'):o=e;let s=Array.isArray(o),a=h.default.useRef({stale:1,justSubscribed:0,scope:t}),[l,i,c,f,d]=h.default.useMemo((()=>{a.current.stale=1;let e=Array.isArray(o)?[]:{},n=[],r=[],u=[],s=[];for(let a in o){let l=o[a];effector.is.unit(l)||v('expect useUnit argument to be a unit'),effector.is.event(l)||effector.is.effect(l)?(e[a]=t?effector.scopeBind(l,{scope:t}):l,u.push(a),s.push(l)):(e[a]=null,n.push(a),r.push(l))}return[e,n,r,u,s]}),[a,t,...Object.keys(o),...Object.values(o)]),p=h.default.useRef({value:l,storeKeys:i,eventKeys:f,eventValues:d}),y=h.default.useCallback((e=>{let n=a.current;n.justSubscribed=1;let r=()=>{n.stale||(n.stale=1,e())},o=effector.step.compute({priority:'sampler',batch:1}),s=c.map((e=>u(e,r,t,o)));return()=>{s.forEach((e=>e()))}}),[c,t,p,a]),m=h.default.useCallback((()=>{let e,n=p.current,o=a.current,u=0,y=n.value,m=n.storeKeys,h=n.eventKeys,v=n.eventValues,b=t!==o.scope;if(o.stale||o.justSubscribed||b){u=!o.justSubscribed||b,e=s?[...l]:{...l},m.length===i.length&&h.length===f.length||(u=1);for(let n=0;n<i.length;n++){let r=S(c[n],t),o=i[n];u||(u=m.includes(o)?y[o]!==r:1),e[o]=r}for(let e=0;e<f.length;e++){let t=d[e],n=f[e];u||(u=h.includes(n)?v[h.indexOf(n)]!==t:1)}}return u&&(n.value=e),n.storeKeys=i,n.eventKeys=f,n.eventValues=d,o.stale=0,o.justSubscribed=!u,o.scope=t,r?n.value.unit:n.value}),[y,c,d,t,p,a]);return n.useSyncExternalStore(y,m,m)}function i([e,t],n){let o,s,a,l,i=g;t?(o=t,a=e,l=[]):({fn:o,store:a,keys:l,defaultValue:s,updateFilter:i=g}=e),effector.is.store(a)||v('useStoreMap expects a store'),Array.isArray(l)||v('useStoreMap expects an array as keys'),'function'!=typeof o&&v('useStoreMap expects a function');let c=h.default.useCallback((e=>u(a,e,n)),[a,n]),f=h.default.useCallback((()=>S(a,n)),[a,n]),d=h.default.useRef(),p=h.default.useRef(),y=h.default.useRef(l);return r.useSyncExternalStoreWithSelector(c,f,f,(e=>{if(d.current!==e||!((e,t)=>{if(!e||!t||e.length!==t.length)return 0;let n=1;for(let r=0;r<e.length;r++)if(e[r]!==t[r]){n=0;break}return n})(y.current,l)){let t=o(e,l);void 0===t&&void 0!==s&&(t=s),d.current=e,y.current=l,void 0!==t&&(p.current=t)}return p.current}),((e,t)=>!i(t,e)))}function c(e,t={},n){let{open:r,close:o,set:u}=l({open:e.open,close:e.close,set:e.set},n),s=h.default.useMemo((()=>({open:r,close:o,set:u})),[e,r]),a=h.default.useRef({value:null,count:0});b((()=>(s.open(a.current.value),()=>s.close(a.current.value))),[s]),((e,t)=>{if(e===t)return 1;if('object'==typeof e&&null!==e&&'object'==typeof t&&null!==t){let n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return 0;for(let r=0;r<n.length;r++){let o=n[r];if(e[o]!==t[o])return 0}return 1}return 0})(a.current.value,t)||(a.current.value=t,a.current.count+=1),b((()=>{s.set(a.current.value)}),[a.current.count])}function f(e){let t=h.default.useContext(k);return e&&!t&&v('No scope found, consider adding <Provider> to app root'),t}function d(e,t){return a(e,f(null==t?void 0:t.forceScope))}function p(e,t){function n(e){let n=h.default.useRef(e),o=d(r);b((()=>(u({props:n.current,state:r.getState()}),()=>{a({props:n.current,state:r.getState()})})),[]);let s=t(e,o);return n.current=e,s}let r;effector.is.store(e)?r=e:'object'==typeof e&&null!==e?r=effector.combine(e):v('shape should be a store or object with stores');let o='Unknown';r&&r.shortName&&(o=r.shortName);let u=effector.createEvent(),a=effector.createEvent();return n.mounted=u,n.unmounted=a,s(`${o}.View`,n)}function y(e,t){let n=t?e:e[0];(e=>{(e=>{if(!e)throw Error('expect first argument be an object')})(E(e)||(e=>'function'==typeof e)(e))})(n);let r=n.or,o=n.and;if(o){let n=t?o:o[0];if(E(n)&&'and'in n){let n=y(o,t);e=n[0],r={...r,...n[1]}}else e=o}return[e,r]}function m(e,t){let n,r=t&&(e=>E(e)&&(e.and||e.or))(t[0])?t:[{and:t}],[[o,u],s]=y(r),a={},l={},i=s;return'string'==typeof o?(l={name:o},(e=>E(e)&&'sid'in e)(u)||(a=u||{})):(e=>E(e)&&('domain'in e||'defaultState'in e||'name'in e))(o)&&(l=o,a=o.defaultState||{},n=o.domain),{hook:e,domain:n,defaultState:a,mainConfig:l,maybeConfig:i}}var h=o(t);let v=e=>{throw Error(e)},b='undefined'!=typeof window?h.default.useLayoutEffect:h.default.useEffect;const S=(e,t)=>t?t.getState(e):e.getState(),g=(e,t)=>e!==t,k=h.default.createContext(null);let{Provider:x}=k,j=e=>console.error(`${e} is deprecated`),C=e=>t=>{let n=e;return'function'!=typeof e&&(n=t,t=e),s(`Connect(${n.displayName||n.name||'Unknown'})`,(e=>h.default.createElement(n,{...e,...d(t)})))},E=e=>'object'==typeof e&&null!==e,$=(e,t={})=>(E(e)&&($(e.or,t),((e,t)=>{for(let n in e)t(e[n],n)})(e,((e,n)=>{(e=>void 0===e)(e)||'or'===n||'and'===n||(t[n]=e)})),$(e.and,t)),t);e.Provider=x,e.connect=C,e.createComponent=p,e.createContextComponent=(e,t,n)=>(j('createContextComponent'),s(`${e.shortName||'Unknown'}.ContextComponent`,(r=>{let o=h.default.useContext(t),u=d(e);return n(r,u,o)}))),e.createGate=(...e)=>(({domain:e,defaultState:t,hook:n,mainConfig:r,maybeConfig:o})=>{function u(e){return n(u,e,f()),null}let a=$({or:o,and:r}),l=`${e?`${e.compositeName.fullName}/`:''}${a.name||'gate'}`,i=effector.createEvent({name:`${l}.set`,sid:a.sid?`${a.sid}|set`:void 0}),c=effector.createEvent({name:`${l}.open`,sid:a.sid?`${a.sid}|open`:void 0}),d=effector.createEvent({name:`${l}.close`,sid:a.sid?`${a.sid}|close`:void 0}),p=effector.createStore(Boolean(0),{name:`${l}.status`,serialize:'ignore'}).on(c,(()=>Boolean(1))).on(d,(()=>Boolean(0))),y=effector.createStore(t,{name:`${l}.state`,sid:a.sid}).on(i,((e,t)=>t)).on(c,((e,t)=>t)).reset(d);if(e){let{hooks:t}=e;effector.launch({target:[t.store,t.store,t.event,t.event,t.event],params:[p,y,c,d,i]})}return u.open=c,u.close=d,u.status=p,u.state=y,u.set=i,s(`Gate:${l}`,u)})(m(c,e)),e.createReactState=(e,t)=>(j('createReactState'),C(t)(e)),e.createStoreConsumer=e=>p(e,(({children:e},t)=>e(t))),e.useEvent=(e,t)=>((e,t)=>{if(!t)return e;let n=effector.is.unit(e)||'object'!=typeof e?{event:e}:e;return h.default.useMemo((()=>{if(effector.is.unit(e))return effector.scopeBind(e,{scope:t});let n=Array.isArray(e)?[]:{};for(let r in e)n[r]=effector.scopeBind(e[r],{scope:t});return n}),[t,...Object.keys(n),...Object.values(n)])})(e,f(null==t?void 0:t.forceScope)),e.useGate=(e,t={},n)=>c(e,t,f(null==n?void 0:n.forceScope)),e.useList=(e,t,n)=>((e,t,n)=>{let r,o,u,l=[];'object'==typeof t&&null!==t?(t.keys&&(l=t.keys),({fn:r,getKey:o,placeholder:u}=t)):r=t,effector.is.store(e)||v('expect useList first argument to be a store'),'function'!=typeof r&&v("expect useList's renderItem to be a function"),Array.isArray(l)||v("expect useList's keys to be an array");let c=h.default.useMemo((()=>{let t=s(`${e.shortName||'Unknown'}.Item`,(t=>{let{index:r,keys:o,keyVal:u,value:s}=t;if(f.current[1])return f.current[0](s,u);let a=i([{store:e,keys:[r,...o],fn:(e,t)=>e[t[0]]}],n);return f.current[0](a,r)}));return h.default.memo(t)}),[e,n,!!o]),f=h.default.useRef([r,o]);f.current=[r,o];let d=h.default.useMemo((()=>l),l);if(o){let t=a(e,n);return 0===t.length&&u?u:t.map((e=>{let t=f.current[1](e);return h.default.createElement(c,{keyVal:t,key:t,keys:d,value:e})}))}{let t=i([{store:e,keys:[e],fn:e=>e.length}],n);return 0===t&&u?u:Array.from({length:t},((e,t)=>h.default.createElement(c,{index:t,key:t,keys:d})))}})(e,t,f(null==n?void 0:n.forceScope)),e.useStore=d,e.useStoreMap=(e,t)=>i([e,t],f(null==e?void 0:e.forceScope)),e.useUnit=(e,t)=>l(e,f(null==t?void 0:t.forceScope)),Object.defineProperty(e,'__esModule',{value:1})}));
//# sourceMappingURL=effector-react.umd.js.map
